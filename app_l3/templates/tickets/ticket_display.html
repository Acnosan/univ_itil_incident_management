{% extends 'base.html' %}

{% load static %}

{% block css%}
<link href="{% static 'app_l3/display_style.css' %}" rel="stylesheet" type="text/css">

{% endblock %}
{% block title %}TicketDisp{% endblock %}

{% block content %}
<body>
    <div class="mainscreen">
        <div class="card">
            <div class="leftside">
                <img
                src="https://static.vecteezy.com/system/resources/previews/025/009/619/large_2x/3d-render-abstract-simple-neon-background-ultra-violet-rays-blue-and-pink-glowing-lines-cyber-network-data-speed-of-light-space-and-time-strings-ai-generative-free-photo.jpg"
                class="profilepic"
                alt="pfp"
                />
            </div>
            <div class="rightside">
                <h1>Ticket Details</h1>
                <div class="container">
                    <div class="box">
                        <h2>(+)ID : {{ ticket_display.id }}</h2>

                        <h2>(+)Ticket Title : <p>{{ ticket_display.title }}</p></h2>

                        <h2>(+)Category / Status / Priority</h2>
                        <p>{{ ticket_display.category }} / {{ ticket_display.status }} / {{ ticket_display.priority }}</p>
                    </div>  
                    <div class="box">
                        <h2>(+)Assigned to : <p>{{ ticket_display.assigned_to }}</p></h2>

                        <h2>(+)Assigned by : <p>{{ ticket_display.assigned_by }}</p></h2>
                    </div>
                    <div class="box">
                        <h2>(+)Creation Date : <p>{{ ticket_display.ticket_creation_date }}</p> </h2>

                        <h2>Attachment</h2>
                        {% if ticket_display.attachment %}
                        <a href="{% url 'download_attachment' ticket_title=ticket_display.title %}" id="download-link" target="_blank">Download Attachment</a>
                        {% else %}
                        No attachment available
                        {% endif %}
                    </div>
                </div>
                <h2 style="padding-top: 30px;">Description</h2>
                <div class="scroll-container">
                    <p>{{ ticket_display.description }}</p>
                </div>

                <h1>Ticket Solutions</h1>
                {% if ticket_solution %}

                    {% for solution in ticket_solution %}
                    <div class="container">

                    <div class="box">
                        <h2>Solution By :</h2>
                        <p>{{solution.solution_by.tech_as_user.first_name}} {{solution.solution_by.tech_as_user.last_name}}</p>

                        <h2>Solution State :</h2>
                        {% if solution.confirmed_solution %}
                            <p>Confirmed Solution</p>
                        {% else %}
                            <p>Not Confirmed Solution</p>
                        {% endif %}
                    </div>

                    <div class="box">
                        <h2>Solution Description</h2>
                        <div class="scroll-container">
                            <p>{{solution.solution_description}}</p>
                        </div>
                    </div>

                    </div>
                        {%if not solution.confirmed_solution %}
                        <div class="set">
                            <a href="{% url 'home' type_user=type_user %}" ><button type="button">Return</button></a>
                            <form action="{% url 'confirm_ticket' ticket_title=ticket_display.title solution_id=solution.id %}" method="post">
                                {% csrf_token %}
                                <a style="font-size: 13px;" ><button type="submit" name="confirm" >Confirm</button></a>
                            </form>
                            <form action="{% url 'delete_ticket' ticket_title=ticket_display.title %}" method="post">
                                {% csrf_token %}
                                <a><button type="submit" class="btn btn-primary" onclick="return confirm('Are you sure you want to delete this ticket?')" >Delete</button></a>
                            </form>
                        </div>
                        {%else%}
                        <div class="set">
                            <a href="{% url 'home' type_user=type_user %}" ><button type="button">Return</button></a>
                            <form action="{% url 'download_solution' ticket_title=ticket_display.title  solution_id=solution.id %}" method="post">
                                {% csrf_token %}
                                <a style="font-size: 13px;" ><button type="submit" name="confirm" >Download Solution</button></a>
                            </form>
                            <form action="{% url 'delete_ticket' ticket_title=ticket_display.title %}" method="post">
                                {% csrf_token %}
                                <a><button type="submit" class="btn btn-primary" onclick="return confirm('Are you sure you want to delete this ticket?')" >Delete</button></a>
                            </form>
                        </div>
                        {% endif %}

                    {% endfor %}
                {%else%}
                    <h2>Solution</h2>
                    <p>No Solutions For Now</p>
                    <div class="set">
                        <a href="{% url 'home' type_user=type_user %}" ><button type="button">Return</button></a>
                        <form action="{% url 'add_solution_form' ticket_title=ticket_display.title %}" method="post">
                            {% csrf_token %}
                            <a><button type="submit" class="btn btn-primary">Solution</button></a>
                        </form>
                        <form action="{% url 'delete_ticket' ticket_title=ticket_display.title %}" method="post">
                            {% csrf_token %}
                            <a><button type="submit" class="btn btn-primary" onclick="return confirm('Are you sure you want to delete this ticket?')" >Delete</button></a>
                        </form>
                    </div>
                {%endif%}
                
                
            </div>
        </div>
    </div>
</body>

{% endblock %}

{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get the download link
        var downloadLink = document.getElementById('download-link');
    
        // Add a click event listener to the download link
        downloadLink.addEventListener('click', function(event) {
            // Prevent the default link behavior (preventing navigation)
            event.preventDefault();
    
            // Open the download link in a new tab
            window.open(downloadLink.href, '_blank');
        });
    });
</script>

{% endblock %}